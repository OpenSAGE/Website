{"componentChunkName":"component---src-templates-post-js","path":"/blog/roads-how-boring-part-8-rendering-crossings-continued","result":{"data":{"markdownRemark":{"html":"<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the eighth post in a series describing the journey. <a href=\"/blog/roads-how-boring-part-7-rendering-crossings\">Last time</a>, we started rendering crossings and found the formulas for calculating the rectangles in world coordinates based on the parameters <code>RoadWidth</code> and <code>RoadWidthInTexture</code>.</p>\n<h2>Texture coordinates</h2>\n<p>Now we need to find the coordinates of these rectangles in the road texture, just as we did for the straight roads in <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">part 4</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 512px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1da157f61d15aed7f18fa04587e9a228/01e7c/crossing_texture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEzElEQVQ4y61UXWwUVRQeY7oIgi+mSkx8MCFGTIAESASKIZKoNQQrInY3sGX/5mdnZndmdv73r+xCd7tCy267dLG00SaAiVGjGDCIEowlQZ73QURrTG2o0gKF2jJd5HjuWprw4JuTfDn3nnvud++c891DTf816ZqcGHf9cW3UNX37hmt66o5rZnbWNTY65rp5fdwFtZsuAAcBC5ibcVzO7Izrzq1JnN+r+2anb7h+G/l1EaXoRlXW9DpihllVTatKfDGEgj4pFquKklwVEFE1VlUMYyFGimnVaEzFvdr8XrtKMYIIBKwYAS4SnUcEwmgZngc/zUCQ5aAtSENbIAh0mAeOxCJYIYJrYfAz7AIHJcoxBzc7OHF4SXZEJeZEYqpD/GTOCqLDkbWIhIjW/dGY5kiqVo/DmzuCrOA+1Ymij0InYNC/J4pRECQFkBSIHwkXbk784aiEVgb8TYgoaj0mMj8WZQRaykqk+nQ7XsEclAlw3KvbibKVTPUall02LKuiIzTTrGiGWSE+O5XGmPgR07IrViJZMeOJimHH+4x4skz971+mI7c1nc0qumVfosPCJuKT4onFFMCSHefOrWlrby/t7Orqajl48FA4ny83f/Ptalxr2NNb3usxrQ+395TLbx/IHfV3dZc8F4efoTA/o5Kmg6TqgPL4un4KwCOvXvnpOdu0TquqBnK6HUTbhnQqDbppfbUKoDGQzR7XMH+cnQAhpoEST4C7VGqi+Kg8Isr1QsxEsBiBUGgP4WQGB71WMgneEFPzKupdL1bWG6Rr1r59QH/xeUugI9fN8QIE4olZlhccD8a+duTIRormwj8TnRG91Ykl+Rft7JmleMvHArLiDxQK4EftBTge2Ox+2GsYAXIgm8sPhFGntGHcRcK5vYkEbOvt3UihXMYJEap9BKs3lO3IbaF/v/YoEi4jG3mOa5UU5W8Jb88znHs+JYvZzsJJ3TSBxpsJuBbFdLQWezZTBwqFdblCYfXZC8PLHhRq3YXvHn/x++FNKy5f3rjkytVVrSc/krefObMLiZYvnZpaifYpb0/Pu7uTqf6dnZ3dnmSqx9vV/d62Sz80PlRxuVhsINbf37/Thwl3J5KTe9L7pkKSckMvliJkrfHq1Sca5mqN/ykbzbKbH4wTmcyajGm+5O/rezNiGOBT9ftCKgVhzKFqmNCZyzPzv7ycP3z4HKvrt7y95bFQIjmulUqj7lOnXqBQe1WaF1aQOFoUtzLBEE8PDjTzpkUahBOWlfv4Vu8FuTBgl4FsvsAj4dNCPH6dZbj6c6XRypjDYP/7m4lsJrAwx+tSESNbmFDIH+o/9gYhRFnMMbxwn3QVPirVGEEAGXXZPHzxFV9H7seAPwDv6EbNx3C1YCYLu4eGNlBt/uA17CIQYtkmTlbWsjTD0wPHXhcsi/zqbFgQaygrQgwMijvAsH5SFCaZHAv4/OBDnQb9wRqN8bsHBpqoiKKcxu7xpayqKyXDXCvxwlso6hYDT+RQ/Uw8DrKCnQa7jo/lfPM5fJbOZEc4ywZPsQSh9gxEO3LQMjCw/uF3XepZQmzriRPrPNn9J3YdPFTZkc8fbUunP3AXi+RmrqUTE8vRPun++JPnPeXyy9vPn9/gHhpqCn362fpFf95u+AcLMvJpreAztgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Node positions in the crossing textures\"\n        title=\"Node positions in the crossing textures\"\n        src=\"/static/1da157f61d15aed7f18fa04587e9a228/01e7c/crossing_texture.png\"\n        srcset=\"/static/1da157f61d15aed7f18fa04587e9a228/8a4e8/crossing_texture.png 150w,\n/static/1da157f61d15aed7f18fa04587e9a228/5a46d/crossing_texture.png 300w,\n/static/1da157f61d15aed7f18fa04587e9a228/01e7c/crossing_texture.png 512w\"\n        sizes=\"(max-width: 512px) 100vw, 512px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Let's start by dividing the whole texture into a 3x3 grid. The center of the T crossing is located at the center of tile [2, 3], and the center of the X crossing is located at the center of tile [3, 3]. In texture space, they are located at [3/6, 5/6] and [5/6, 5/6] respectively. However, as we found out in <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">part 4</a>, the engine approximates 1/6 as <code>1.666</code>, truncating all decimal places after the third. This also happens for the center of tile two, which is not <code>0.5</code>, but <code>0.498 (3 * 1.666)</code>.</p>\n<p>We also already know that the default road width of <code>0.25</code> is scaled with the factor <code>RoadWidthInTexture</code>. Now we only need the lengths of the small extruding stubs. By measuring some textures of different sizes, we can find out that it is <code>0.004</code> regardless of <code>RoadWidthInTexture</code>.</p>\n<p>Using the variables</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Abbreviation</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Half tile width</td>\n<td><code>htw</code></td>\n<td><code>0.166</code></td>\n</tr>\n<tr>\n<td>Half road width</td>\n<td><code>hrw</code></td>\n<td><code>0.25 * RoadWidthInTexture / 2</code></td>\n</tr>\n<tr>\n<td>Length to incoming road</td>\n<td><code>lti</code></td>\n<td><code>0.25 / 2 + 0.004</code></td>\n</tr>\n</tbody>\n</table>\n<p>this gives us the following texture coordinates for the T- and X-crossing:</p>\n<table>\n<thead>\n<tr>\n<th>Crossing type</th>\n<th>Left</th>\n<th>Top</th>\n<th>Right</th>\n<th>Bottom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>T</td>\n<td><code>5 * htw - hrw</code></td>\n<td><code>3 * htw - lti</code></td>\n<td><code>5 * htw + lti</code></td>\n<td><code>3 * htw + lti</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td><code>5 * htw - lti</code></td>\n<td><code>5 * htw - lti</code></td>\n<td><code>5 * htw + lti</code></td>\n<td><code>5 * htw - lti</code></td>\n</tr>\n</tbody>\n</table>\n<p>Unfortunately the two Y crossings are a little less straight forward and require some hardcoded numbers (this time, width and height are given instead of right and bottom coordinates):</p>\n<table>\n<thead>\n<tr>\n<th>Crossing type</th>\n<th>Left</th>\n<th>Top</th>\n<th>Width</th>\n<th>Height</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Symmetric Y</td>\n<td><code>3 * htw - 0.2</code></td>\n<td><code>0.504 - 0.135</code></td>\n<td><code>0.4</code></td>\n<td><code>0.270</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td><code>0.395 - hrw</code></td>\n<td><code>0.645</code></td>\n<td><code>1.2 * 0.25 + hrw</code></td>\n<td><code>0.335</code></td>\n</tr>\n</tbody>\n</table>\n<p>Using these coordinates, we can now render the crossings, but it doesn't look quite right yet:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f6440e9de7068e02250fc08ac93fc9f/eb3fa/crossing_overlap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADHUlEQVQozyVSa0/cRhT1X+iHSoQGKFmvH2vvrhfYlz2esT22xzP2PLzehfBQgqqmaqX+o1RRW5WQAoGI8AM7pNLR1f1wzz06517j+uP76+s/rq7e/4+7uw+3Nx++fLn6+nj99PTp6eunx8fr+4erz5//ub+/enj4qOvt3d//3vx5c/uXMQ62jqYv5/Od2TN2w3AvinYA2JvPf5jPX37rd6fT7clkKwheaIyDF5OD7cnBczXS1I2hpYGQFUY9iKwMOyhxFqE5m/WWoQliE8I+iPuLsBeCPs6donBq5gs+MsrS0aiIy+igpp4So6pyk7SfJBYAPQ3dJEkfYydGZgx7eph+GxaNZzTMldxftxPF/VaMVjIQtccbT/IRb/yKuk09ENxraktJv2YDSh29vShdjG1D8qEUQ8YGJbHrZlAzl1KbVD4XgZLjlRpJeVhWIWOLVh11arRpJ107VnJY165BKi8vBjGyItAHUDscHM2DEIakirrnOb0X4rwoyko0ccu9TgVdO9JirPGNJHOi2FwuXy2W+zqVNPMX4WwZhQBBXABCZylGeZkWJNt04en6cK0mmy6om2GKXQOhfhzbEbABsFFiEeJRdphgNAdRhOIIQg2QQFbnJ+vpZjXWAekUlPC1R00249jSssvQCoEZgV4Mf8TlGJcYJTHOUZonMENK5eevpys1rIhNiNWpieSeoQ1rqwdHO2HYh8iOkR1BE6J9IRZFkWQ4pjTHeco57Fpfk4WYsHos5VBfxIDQ1OJp5mDs5qWf4udLVIUludt1aZImeZEVZV6SfKWWNbU582Tj89plzDHSbEjZUMhAykCpQD9JJ0crFbRqeHq8bGqCEqSZOMeUlUpOWWWLxi9LM8OvjIoMlRoJrj/Oeg6jcTl3lPKE8NbtuFNhhrMszxglml+zQrCxYK7Wp8Q2Vmft5u3x5ny96ZDkFinNhlgtP6irOSsOTlqwamgKk7LIKS1rLi4uL49PyeZ1JRQwvt/d39q3vtveG0Xo4udzdZaU7+bFrxRcluCygD+V9Pc6O8Nyvbn45Tf15l3WvcnECSBiCtF/838Eu7shJbYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Crossing and road segments overlap\"\n        title=\"Crossing and road segments overlap\"\n        src=\"/static/5f6440e9de7068e02250fc08ac93fc9f/0a47e/crossing_overlap.png\"\n        srcset=\"/static/5f6440e9de7068e02250fc08ac93fc9f/8a4e8/crossing_overlap.png 150w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/5a46d/crossing_overlap.png 300w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/0a47e/crossing_overlap.png 600w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/1cfc2/crossing_overlap.png 900w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/eb3fa/crossing_overlap.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The crossing texture and the straight road segment textures overlap because the segments all start directly at the node position.</p>\n<h2>Connection points</h2>\n<p>We need to move the end points of the incoming road segments outwards to the positions labeled A-M in the image above.</p>\n<p>The following table lists the vectors that need to be added to the node positions to get to these connection points (<code>Up</code>, <code>Down</code>, <code>Left</code>, <code>Right</code>, <code>DownLeft</code> and <code>DownRight</code> being unit vectors pointing in the respective directions and <code>Width</code> and <code>Height</code> referring to the rectangles we calculated in the <a href=\"/blog/roads-how-boring-part-7-rendering-crossings\">last post</a>).</p>\n<table>\n<thead>\n<tr>\n<th>Crossing type</th>\n<th>Position</th>\n<th>Vector from</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Symmetric Y</td>\n<td>A</td>\n<td><code>Up * (0.269 * Height)</code></td>\n</tr>\n<tr>\n<td>Symmetric Y</td>\n<td>B</td>\n<td><code>DownRight * (0.547 * RoadWidth)</code></td>\n</tr>\n<tr>\n<td>Symmetric Y</td>\n<td>C</td>\n<td><code>DownLeft * (0.547 * RoadWidth)</code></td>\n</tr>\n<tr>\n<td>T</td>\n<td>D</td>\n<td><code>Up * (Height / 2)</code></td>\n</tr>\n<tr>\n<td>T</td>\n<td>E</td>\n<td><code>Right * (Width - HalfRoadWidth)</code></td>\n</tr>\n<tr>\n<td>T</td>\n<td>F</td>\n<td><code>Down * (Height / 2)</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td>G</td>\n<td><code>Up * 0.2 * Height</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td>H</td>\n<td><code>Down * 0.8 * Height</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td>I</td>\n<td><code>DownRight * (1.047f * RoadWidth)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>J</td>\n<td><code>Left * (Width / 2)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>K</td>\n<td><code>Up * (Height / 2)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>L</td>\n<td><code>Right * (Width / 2)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>M</td>\n<td><code>Down * (Height / 2)</code></td>\n</tr>\n</tbody>\n</table>\n<p>And now, finally, the crossings are done:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/146dc252e309f1e32f593bcb05316ade/eb3fa/crossing_no_overlap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADIElEQVQozxVS2W7bRhTlL/ShqGskjjbuomSbEtfhkLNwhhRXiZKsxE6ToElRoH/UNnmKZbstaqntB3YEXFxgBvfcs8xIjw+/7/e/7ve/PT5+fnr6/NefX/54+vL389fjP/vjYX887g+n/nA43D8/34vjf/8+iDoe7w+HrxJBA0oGnMmUDhM0AFEPgJ49+962z+fz87nzYjI9sybfXV6dzZzzIHgRw1cCQlAfJa+kprF4NoaxGgLZ8wZBMKSpjolKqQ6h6npD1x2IewhljFWW6mVh1aVVFma5GEtta3Gmicozg3MDEw1jLYKjBCkRlF2v53l91xv4wRAjjWCZUSXnRs71jGkSoYYYxVg5EVKVED2K5LnTEyUAcSwLThCN4kQmqZIvTMZVznXGdJoaEkyUAMh+MApC4VkhVAhW01SNYi0EozAc+cHA8TTHMyOoI6yB6DRGUy3LTakqxykTnhWBF1RhOPRDa+7ZtjObu5bnD3xfvp7bjue7vu/5xsy58ANZUAotkvApBARg6Lgi5AsRW4KsMAocz5u5bhTPYOwGAIA4QjhiqRlDFQAZoVM0khf0RdSYmBDqAChiZZFbTe0mKAYQ+CD0At8LPccPYGLzzMjyMecmz0ye61KMVBEDz3RCNZKaiGoJkuOkFyMbwCjBcQgBTKBgruqgqieLYsy4zJjWNrZU1dNuaXEuL3Jj2Uybdsq4Hkb9CKkJhQJMOSUpYhnerJ1NN20bq8iNqhh3qytp2VjlQtt0l1073XbXdTEuF+IZNbFutfIRFviIMIwIqiq3KtS6NLulGLPW7VR6vXVuNvPdjS3wm81s1V51zaRrL+vKWHfTuo4TBBnHmIhO2maecaU+fTKzLAxpvbR2m6tlY5SFVpfjstSLhdLUelmq6+V02diUxYKcZQRhlGe4XJiLTC64kiQX0uv368279c3derfFQlWajjI6rMtJxuwsvV43XltQEPgYR1meFnV99+Htm7t8d7tYdon07cv+WV/95rxnBXD34TbfQvLRSX/Ow3dp+D5NfuT8lxzexNVqdfvpp+btJ7z6AdfbkFdODP8HXtb+QMaDEo8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Crossing and road segments don&#39;t overlap anymore\"\n        title=\"Crossing and road segments don&#39;t overlap anymore\"\n        src=\"/static/146dc252e309f1e32f593bcb05316ade/0a47e/crossing_no_overlap.png\"\n        srcset=\"/static/146dc252e309f1e32f593bcb05316ade/8a4e8/crossing_no_overlap.png 150w,\n/static/146dc252e309f1e32f593bcb05316ade/5a46d/crossing_no_overlap.png 300w,\n/static/146dc252e309f1e32f593bcb05316ade/0a47e/crossing_no_overlap.png 600w,\n/static/146dc252e309f1e32f593bcb05316ade/1cfc2/crossing_no_overlap.png 900w,\n/static/146dc252e309f1e32f593bcb05316ade/eb3fa/crossing_no_overlap.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In the next post we'll tackle the curves.</p>","frontmatter":{"slug":"roads-how-boring-part-8-rendering-crossings-continued","title":"Roads? How boring! Part 8: Rendering crossings (continued)","summary":"Part 8 of the series about rendering the roads in SAGE maps: Rendering crossings (continued)","author":"Daniel Sklenitzka","date":"2020-04-19"}}},"pageContext":{"slug":"roads-how-boring-part-8-rendering-crossings-continued"}}}