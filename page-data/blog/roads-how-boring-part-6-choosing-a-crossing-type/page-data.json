{"componentChunkName":"component---src-templates-post-js","path":"/blog/roads-how-boring-part-6-choosing-a-crossing-type","result":{"data":{"markdownRemark":{"html":"<style type=\"text/css\">\nimg[src*=\".gif\"] {\n  margin-left: auto; \n  margin-right: auto; \n  max-width: 500px;\n  display: block;\n}\n</style>\n<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the sixth post in a series describing the journey. <a href=\"/blog/roads-how-boring-part-5-connecting-the-road-segments\">Last time</a>, we rendered road segments with angled connections. Before we examine the other connection types (tight and broad curves), let's take a look at the crossing textures:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 512px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72568cae73fb037fad88ceedc4e416dc/01e7c/texture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7BAAAOwQG4kWvtAAAEhklEQVQ4y61UTWhcVRR+UjsiKuKqu4Ib0UJVElOkiBUVGkFTqBKTmkkmM/Pem/fuve//f36S+c3PZCTF/CCp0CxU3IkoqODOha4UHIsLjUoTE0tSqk2TvEzi9dyXTKALdz74uPedc+6595zzncNt3tmIbayvxf5cvR7b/PtmbPOv27Gt7e3Y8vJK7NaN1dgOvROjtAWgR9jdCmPh9lbs9q0N+N+LZNubN2O/L/16H6fbTlOz7AiG4zZN12symQHQbZDrRhOrGkBtqobR1B3nyEY1rKZimHDWOjzrNzkBYcogYkIzRDkEoTKsaYSolBimQV8/dd7opUPJFOVlRDPMFiAiQlOiRIcF8cgHhzUjlIgSwk8oq1qIdSMkhhkyOfsXEQ4lAAIbuCQkIFcMK1RNK7JDYIM0Hc6ZoQIyDoQUDh/ciBWKVJ2CU8rk4PDw5SqFQ1RSYAUZhEmJbkY25HCPNQCsnJfNz9l+MA85mGGA/TsMXi7P1lkHdLbnz1uuF4HJ/HyB6eaYzsvl5p1sbt4OsvNOkJvh/vevMDbxol+r6WaQ/UaQ5LNMBi+9n61jjcajgqZdFnWjMYzJlOH5s+VK7STTwet6k4I4p+hmXZDwtOX6xfmFhUc4NSNdH5Vk6kV50r5sX7T44UcPu0HwhQe5Kzgu9SB3pXyBWn7wOfCOA5pd0VyPqo5HkWVTzXaoZhjPcASTJUeWqUGULQLFSKb5OHNYrFZf9fN5qvRfallvxXfs+NCOODC45xUK9O3L02dNy67pQBc/ld5yEsO7GZ7fT2DcyUmC+LMVH6SZ4SRF4BBI/MvC1StRyALGKc336RBEMCQhyl4kyCjBdFCoGQxyPSNta2m+JUvyfkpROjkZ4TUdqGGY5pJfKCyWamPnvvv+2j3t0CWE+qBDqGZaNIPwpbbcCbLvQU6pAqEi06QqhK0aZhdXnpzsHJ1qPPnJ198+1Da2nOA4cO9EWsYnXurueSBfLPYUq7XOw5fde+AwuACvnUaKUhVluQ6tmp2enXvwroqPlCvHo8qXSq/wkrzJS2gFumgNyL1SrNTSTJfg08euvvv+f9PGddzu9j4/MvpUNp9/NigUzhPLoiJUnuVNhA4xIbzq+KTUtgWbj5Gqrlue/xsU849ipXKtNjF5krOGEj99dfr0CxH/Uulz4z0X8lOe162CEyLJuyrC+xpR9ngxQw1wXh6bkJktTJgbAhRKhCGSkjHVXZdmC/kzQBtl3eCFD6ICyOh5JTEslkaLL+fAgRcfbHkD8X9cmDgE4RabKKw44/XGYzAcfiQDcar39e+6vW/uWZjsa6VSB5cZiK9mgTJKIvEcxuTpysXXc3XP7UbQ9AJMIIEorWRG2mVjCwPJoTsi2kCYy8kUT5PJ9F46xe8jGHl2NujisK5/RkzzU8WynoCB2gF5uViqVs9D0x9MFXDCaCMBtZK8kGjnEGjyA5tG2LD2ZbCBdg0hDafuKtDEZD0idHZk5HGobgNGVQWqXZEJqWum+RrTiVLmWFTAcvWkZttnCuVyh+l5XeP1qVNEWuT+BUx/xSNleKnNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A sample road texture\"\n        title=\"A sample road texture\"\n        src=\"/static/72568cae73fb037fad88ceedc4e416dc/01e7c/texture.png\"\n        srcset=\"/static/72568cae73fb037fad88ceedc4e416dc/8a4e8/texture.png 150w,\n/static/72568cae73fb037fad88ceedc4e416dc/5a46d/texture.png 300w,\n/static/72568cae73fb037fad88ceedc4e416dc/01e7c/texture.png 512w\"\n        sizes=\"(max-width: 512px) 100vw, 512px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We need crossings when three or four edges of our road graph meet at the same node. There is no texture for five or more edges, so in that case the segments are just rendered as straight roads without connections (so this case should be avoided when creating maps). There is only one crossing texture for four connected edges, but we have three variants of three-way crossings. We need to decide which one to use based on the angles between the three segments:</p>\n<p><img src=\"/0268f454979943de4f6a2433486299ea/crossing.gif\" alt=\"As the angle between the segments changes, so does the crossing texture\"></p>\n<p>For each edge, we calculate the direction vector and the angle between this vector and the X-axis:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 340px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a451981eca45da2d08df707d2df0ac31/9f933/incoming_road_data.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACM0lEQVQ4y52UYXOaQBCG/f8/pZ/7MU7aZNq0U9RqEkAxMYpABBNBBAFv9+3pNcQYRZMdhjnmeO59d2/vavhgsAwiNa59FF2/gwBR9Abm08gsCNJ+X43/w7R2w6fAM8uKu13lv1ZqOkBxTDvP8yzLys+aIv9GkZfn1SQJkSQJiF4LptwaUfQ8n1dnnua5eMFeq62AWZb5mznelypbVtFu78zUyt3LmP8QqbTL9UkZk27PzqDrME1s1bW2vU8L5rsXY7IAy1K70cD9PZ6fYRiwrNLO7j57RH0iE9CAFnNLdoRtQ9NYNobnwfchzYeh4t90mOJ/Mp8D18CVXILoexwPpOZoxBJ7eFg/vd4eWIVM+wL8A/jK3M5zg/mbEDPPRa9LY3utL1fZ7OsurMR9oA5YK2EKkt3UAcwwhjdlN8B0iusO0nQN07tYCSEnNMf7cnd7geW5COtY1Bcjx/k1tn+TcYtGg6KQVJPshOygtXjqnseXPXgGjQy2Tep3ha4VV+l8gkUqm4z35swb72M4BvQpfBtDF7aPiQvPhFn+sP88qzkLVh99F+4lLnXoAYIuuiOMToKliIQf8ejAmWAyxriJZvH24B2BpaAPf4hhC60Q4bbsfpg2rX2Dmx56sifkQD4LLHbIKlhnvclNqfmEJz5wUg/a7nAn4aT6ejh4e9oru+DivdXjsGyUYnn0RjsACxJxGlfLVilTRp9UnmUzzddy5DbsCv39cLJKBulAMgmSz1T7lPgH2fDbuZUABsMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Angles between the edges and the X-axis\"\n        title=\"Angles between the edges and the X-axis\"\n        src=\"/static/a451981eca45da2d08df707d2df0ac31/9f933/incoming_road_data.png\"\n        srcset=\"/static/a451981eca45da2d08df707d2df0ac31/8a4e8/incoming_road_data.png 150w,\n/static/a451981eca45da2d08df707d2df0ac31/5a46d/incoming_road_data.png 300w,\n/static/a451981eca45da2d08df707d2df0ac31/9f933/incoming_road_data.png 340w\"\n        sizes=\"(max-width: 340px) 100vw, 340px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We then sort the edges by the angle to get a defined order for the edges around the crossing point. By a simple substraction we can determine the angles between adjacent edges (the angle between the first and last edge is a little more complicated because the sign changes).</p>\n<p>Based on this information we can now choose the crossing type:</p>\n<ul>\n<li>If the largest angle between two edges is significantly smaller than 180Â°, we render a symmetric Y-crossing, because it is the only one where no two edges form a straight road</li>\n<li>Otherwise, if the two smaller angles are similar enough, we render a T-crossing</li>\n<li>Otherwise, we render an asymmetric Y-crossing</li>\n</ul>\n<p>Now that we have decided which texture to render, the next step is to choose the orientation. We need to find a vector in world coordinates that corresponds to the Up vector in texture space. We can again use the angles we calculated before and similar logic as above. In case of the asymmetric Y crossing, it might also be necessary to mirror the texture.</p>\n<p>In the <a href=\"/blog/roads-how-boring-part-7-rendering-crossings\">next post</a>, we'll start rendering the crossings.</p>","frontmatter":{"slug":"roads-how-boring-part-6-choosing-a-crossing-type","title":"Roads? How boring! Part 6: Choosing a crossing type","summary":"Part 6 of the series about rendering the roads in SAGE maps: Choosing a crossing type","author":"Daniel Sklenitzka","date":"2020-03-22"}}},"pageContext":{"slug":"roads-how-boring-part-6-choosing-a-crossing-type"}}}