{"componentChunkName":"component---src-templates-post-js","path":"/blog/roads-how-boring-part-9-rendering-curves","result":{"data":{"markdownRemark":{"html":"<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the ninth post in a series describing the journey.</p>\n<p>As we discovered in <a href=\"/blog/roads-how-boring-part-1-taking-stock\">part 1</a>, there are three ways of connecting road segments:</p>\n<ul>\n<li>Angled</li>\n<li>Broad curve</li>\n<li>Tight curve</li>\n</ul>\n<p>We can already draw angled connections since <a href=\"/blog/roads-how-boring-part-5-connecting-the-road-segments\">part 5</a>, so now let's examine some broad curves:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1c8929e6db757996eb54f562fc41c464/7a1fb/wireframe_curves.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAADvklEQVQ4yz1U2W5cRRC9HwOKEhPbmX3zeILxzN33/c5mExIpYKyYJBbEgcTbeLwgnkL4tki8RQQp4gGIhYjHh3PbwEOp+9btPlV1TlVLr179jLdvf8Pr12/w5pdf8cfv7/Duz3Ocn/+F9+9nuLi4xOUl/jfh+/sCsxn3/Deb0Ymrf7lPOj3dxvH0MY6PaNOvMD3axuTwMW0bB/sPcXjwCCfH3+Ds9Al++P4pjiYPcXKwxf0OJpNHODv7Gj+9PMTLF/v48cUBJMeah2vPIQ4W4dgfwdTnoPSuQ+5egyX2H6LX/UCspnEdjjWHwFtESHN5978zhnaNdgPSvTufYDRoII4qSOMqgqAEzyvzUhu+t4Qk6tB/G2GwxO9VhGGDVsD6eJm+CqKwimG/hSyp01+BtD7uIEsrwpHGNfhukWBlKHIHmqpA02QoSheyvAJV6cE0Ce6XsTZsI+P5KKgyoWUCF9FPm5DCII/QwHjQ4toUoHFYhqreZqk9guUmE5hgRg+uqzN4E0OeTxOVFZnMVBXVjYdLkPppg1HKAiRLaqL0KCzROsymJcyx26ShjbWxhkG/jcAvcG3AdWSYliVAs6SBQVaHlERNeE6BolTJV1WABV5RZOq5JYpQQuxXkXp1+hWCrZCWBWbFoMEqBbX438YwbiHhHSkmYBzVRBmjQZNkLzF6i9F70PUuHFNBaKksV4GjqbAdg+V2SFEDdwY9xJ6NJHAxTj9GGtVzQEb2qaybk1pnlIowQ1+BomqwDB2uqUE3ZQS2gcSXCcjyR01kAWlhhqapI/XzLihCikSpFaFYDhiz7DiosWSFmVoYJDoGgYx+uMqMVvApgcZDijhqEUBjMItlO8y0RR3YNmlcF4LkFgYF9lJJCJNnsD5uXNkotzpGwyqJrxCQfbdmwfYtUqLxngXfr4uWk/IeCoPivySXYduLVDRXWebaY/k69xqz6ZEamdUYiJJciBiqY0HRFXjBCizzJmyrAGlt1GbUGj5b74g+itj9cViDZXUpisEAJvl14Dg2uTI5bh4s32Q2Dv0e3L7KLrnF71ukqnHVh+MhyyMnY6qckccgz9RapTBdRu6xDxV+yyxLR2jb8EMDWWYy+2UGXKBwnGsnb7dK3of5ZBTZNmVhLg/Y5jwpyOe5JMYs5rz6bkFMQxrVxN738sdkHrp2kw/KAkf1Bnt2EdLe7iaODjf5fG1hOtnkk7WBpzt3sfPkLp59ew97z7/AyfQBbYvnHvB528Te7n3s721g9/nn2N/N1y/x7Lv7PLuBfwD9BsYYjVR0RwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Curves are rendered as quads\"\n        title=\"Curves are rendered as quads\"\n        src=\"/static/1c8929e6db757996eb54f562fc41c464/0a47e/wireframe_curves.png\"\n        srcset=\"/static/1c8929e6db757996eb54f562fc41c464/8a4e8/wireframe_curves.png 150w,\n/static/1c8929e6db757996eb54f562fc41c464/5a46d/wireframe_curves.png 300w,\n/static/1c8929e6db757996eb54f562fc41c464/0a47e/wireframe_curves.png 600w,\n/static/1c8929e6db757996eb54f562fc41c464/1cfc2/wireframe_curves.png 900w,\n/static/1c8929e6db757996eb54f562fc41c464/7a1fb/wireframe_curves.png 1030w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>\n<p>Curves are rendered as a series of quads. The number of quads depends on the angle between the two road segments:</p>\n<ul>\n<li>Below 27°, an angled connection is rendered (see top road in the screenshot)</li>\n<li>Then, the number of quads increases in 30° steps, so from 30° to 60° two quads are used, from 60° to 90° three quads, and so on.</li>\n</ul>\n</li>\n<li>The quads overlap their neighbors a little bit.</li>\n<li>The last quad (the purple one in the screenshot) can overlap the previous one more when the total angle isn't a multiple of 30°.</li>\n<li>\n<p>The end points of the adjacent road segments are \"pushed back\" so that there is enough space to render the quads (the straight segments stop where the quads start).</p>\n<ul>\n<li>When we increase the angle so much that the end point would be pushed beyond the start point, an angled connection is rendered instead (not shown in the screenshot).</li>\n</ul>\n</li>\n</ul>\n<h2>Calculating the endpoints</h2>\n<p>Let's start by calculating these new endpoints - the points between which we'll render the curve.</p>\n<p>The curve can also be seen a as a segment of a circle. The radius is a fixed multiple (<code>3.5</code> for broad curves, <code>1.28</code> for tight curves) of <code>HalfRoadWidth</code> (which can be calculated by <code>RoadWidth</code> * <code>RoadWidthInTexture</code> / <code>2</code>).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f9144f5990fd10efc53ad063d8a92428/e8950/curves_drawing_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAGMJAABjCQHsZ98kAAABLklEQVQoz5WTaXODIBCG8///ZD8kmtAZxItj2cOuaC5rkpbZYRB89uLlMP1zsEg7pjZgJjlszoglI7+BRRgRRRfTdIelzG6ELxOcxyERqiOa7ck7kci6s408JqocVE2qXTo1xWxafZGwTDmjOl3wLTxEqh2YFi5XO9982aSLs/VdwJj5JXx5gE27+jIdnGxshnSr8TN899LB0cZ+8Ps1M8t3N+e5Q7agmRsXRX+6dnAbuQsvI+t+Apzk3vy/1ny0ySdt99O9vYPNNVttspIaU+UxfYQXTIvXe750AEVz2ick2oHnay/F9AGrJlZFG6ZNQ1BFqDTmQ8iZ5UltBxWzG3PTR2ZSM42vbeg9DKOfNcyEZTCzj6Dy6ANpdis8J/PgsERZHoD8fhWL2nVePn8AKJFsyUTWnLcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The curve can be seen as a segment of a circle\"\n        title=\"The curve can be seen as a segment of a circle\"\n        src=\"/static/f9144f5990fd10efc53ad063d8a92428/0a47e/curves_drawing_0.png\"\n        srcset=\"/static/f9144f5990fd10efc53ad063d8a92428/8a4e8/curves_drawing_0.png 150w,\n/static/f9144f5990fd10efc53ad063d8a92428/5a46d/curves_drawing_0.png 300w,\n/static/f9144f5990fd10efc53ad063d8a92428/0a47e/curves_drawing_0.png 600w,\n/static/f9144f5990fd10efc53ad063d8a92428/1cfc2/curves_drawing_0.png 900w,\n/static/f9144f5990fd10efc53ad063d8a92428/c1b63/curves_drawing_0.png 1200w,\n/static/f9144f5990fd10efc53ad063d8a92428/e8950/curves_drawing_0.png 2000w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In order to find the center of the circle, we can calulate the average of the direction vectors of the two edges and normalize it. This gives us a direction vector pointing to the center.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f928af453cb4c289b7f20d4196b43ffd/e8950/curves_drawing_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAGMJAABjCQHsZ98kAAAAvElEQVQoz6WT2w6DIAyGef933O1GlkwFlUOPq3Maza5wf0igJF/a/gWnjWLmfswhEZC4VpiISqmiaqsZBgBLvp6b4VrrRVhEDN5D1+rWX3CM0Ty7AsNHVvwV+OhWKywA9Ri7luchKUELbN2ZO0V1UETtOinFOj/D/CNzZdmQeWDpWAcZPU2z5KS4w8TST/AKCRF2mTEhhG+AwE+v/j4/XiFTzDiVbVSWAXnz/jzSQ7u8fAjim0++r5ZvvX4D1+x7xG3Y4EAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Direction to center\"\n        title=\"Direction to center\"\n        src=\"/static/f928af453cb4c289b7f20d4196b43ffd/0a47e/curves_drawing_1.png\"\n        srcset=\"/static/f928af453cb4c289b7f20d4196b43ffd/8a4e8/curves_drawing_1.png 150w,\n/static/f928af453cb4c289b7f20d4196b43ffd/5a46d/curves_drawing_1.png 300w,\n/static/f928af453cb4c289b7f20d4196b43ffd/0a47e/curves_drawing_1.png 600w,\n/static/f928af453cb4c289b7f20d4196b43ffd/1cfc2/curves_drawing_1.png 900w,\n/static/f928af453cb4c289b7f20d4196b43ffd/c1b63/curves_drawing_1.png 1200w,\n/static/f928af453cb4c289b7f20d4196b43ffd/e8950/curves_drawing_1.png 2000w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The length can be easily calculated as <code>radius / cos(α / 2)</code> with <code>α</code> being the curve angle.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6ed813350cd681577791a6dfda012ff9/e8950/curves_drawing_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAGMJAABjCQHsZ98kAAAA+UlEQVQoz52T4W6DMAyEef933CZN09RJFVDIktT22TOhQzSldF3EDxTy2Xe+0NiTC6p9yH1kEm2qbwL13R1YFczsJ/yp4SHQMPIOPJF6qV7DiQBSw39hV25k93iHl/cteC5MxVZtWB/BKBAKfwPHGAFswI61I2FpKK6y1iwidzt/ZwFWcrmU2JrWruw1/zs8kSslf4Bn3uODpiTPwFpkZ7Pe21rbac5GdA37jS1mNJ6FBVaMTVueW696gr3r8CohaorGC+x9ukDtkAAfpBDLNFBhj0TmBcbxyz4+T2/HLsmYOOSL+GbKHaobP4CuMzQvDbwc4qE7L75+AP0QewZBAxm/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Length to center = radius / cos(α / 2)\"\n        title=\"Length to center = radius / cos(α / 2)\"\n        src=\"/static/6ed813350cd681577791a6dfda012ff9/0a47e/curves_drawing_2.png\"\n        srcset=\"/static/6ed813350cd681577791a6dfda012ff9/8a4e8/curves_drawing_2.png 150w,\n/static/6ed813350cd681577791a6dfda012ff9/5a46d/curves_drawing_2.png 300w,\n/static/6ed813350cd681577791a6dfda012ff9/0a47e/curves_drawing_2.png 600w,\n/static/6ed813350cd681577791a6dfda012ff9/1cfc2/curves_drawing_2.png 900w,\n/static/6ed813350cd681577791a6dfda012ff9/c1b63/curves_drawing_2.png 1200w,\n/static/6ed813350cd681577791a6dfda012ff9/e8950/curves_drawing_2.png 2000w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Once we know the vector to the center, we can project it onto the original edge direction vectors using the dot product to get the end points:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a83b718ad53eb4392cb41f9ecad5dd41/e8950/curves_drawing_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAGMJAABjCQHsZ98kAAABDklEQVQoz5WTgW6EIAyGff8HdWbJOUTUSmm7H9CdutzmNQ2B0o/SFhp7U0TVBXIzx6TNZS8lhfUPWFWYGR7QK7wMPHZsYsaWx+p1Oj2pbqYrbMnMm1GZ81kl22Jklg3/BVcnXybbRXdNptHckBOmKC9gLbzbQp2qJUr0tL6AIWuJLyWRAxwCoWb/wbl6Zt2efz1wRanvRK4ynWDcGcFvw5ChpJA7nCMfd27Ae/GS6DS9C1ejN2Z79Lg5Wn2Gc9tz51VjCYF6Yon8oAlzsVV9KyHYMhv/wPD8CrH3i0iCfvaTc5MQLeOIUZAlkXadfbRz+/CUAnGg7fU3CJCf2/PTWN052HJ/8aYxcvk2vBf8G+8seu2/IbaPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Calculating the new end points by projecting the vector to the center on the original edge vectors\"\n        title=\"Calculating the new end points by projecting the vector to the center on the original edge vectors\"\n        src=\"/static/a83b718ad53eb4392cb41f9ecad5dd41/0a47e/curves_drawing_3.png\"\n        srcset=\"/static/a83b718ad53eb4392cb41f9ecad5dd41/8a4e8/curves_drawing_3.png 150w,\n/static/a83b718ad53eb4392cb41f9ecad5dd41/5a46d/curves_drawing_3.png 300w,\n/static/a83b718ad53eb4392cb41f9ecad5dd41/0a47e/curves_drawing_3.png 600w,\n/static/a83b718ad53eb4392cb41f9ecad5dd41/1cfc2/curves_drawing_3.png 900w,\n/static/a83b718ad53eb4392cb41f9ecad5dd41/c1b63/curves_drawing_3.png 1200w,\n/static/a83b718ad53eb4392cb41f9ecad5dd41/e8950/curves_drawing_3.png 2000w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Edge 1 End =\n    Curve Node Position + Edge 1 Direction * Dot (To Center, Edge 1 Direction)\n\nEdge 2 Start =\n    Curve Node Position + Edge 2 Direction * Dot (To Center, Edge 2 Direction)</code></pre></div>\n<h2>Calculating the quad coordinates</h2>\n<p>Now we need to generate the overlapping quads. Just as for the other road types, we need the world coordinates as well as the texture coordinates for the points defining the quads.</p>\n<p>The original engine's quads are neither symmetric nor in any way intuitive to figure out. Besides, they don't seem to work that well anyway:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72e52936f7f0c01a5541c3b4ec94ff21/7a1fb/traintrack_original.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7CAAAOwgEVKEqAAAADkklEQVQ4yx1T2W7bRhTlfxR1600LSZEcbiJFSpQocZvhLmp1ZDtpYCQPjZPateVIUa04dpy8tGjRflwL9DFFkBroixuglq1M+jAvd2bOPeeec4k/fv/z7w9X799/ePfur6urf/69/nh9/fG/m8Xt7d1yufx8lsubm9vFzeLubrm4vVv8X8e3i8Ut8fpi/9XZk7dvDi8vn16cH1ycP3tzeTSf7R8dPjsZH52dHr6+OJzNvp1PHr18+fR0/uTV+f5PP7745ecffvt1ToQBlYQF5K1Cd81z1jx3zXXWrdaqIq6SxRyg1w1tpdX8ul5fMRtfQnfdsdZa5ldG7QuzvkIMB0oYMCFihj25m/FZCpKYSVM2DVm7Lmmq0qqJvktDSAZ+CXlU6HPtBPg+FYccgUsBYsKQ6vf4bgbaMdOO6U7GZhkDLbJWEcqy3KzylplDqBAEFPRIzy0iVExjQKSx4Lo5y1pvJ6VBn98eKbsjpdth45gK/IKpF/WKLEl8VSbN+lrL3vDcTegVk4gNEEUgG/iQxsw7KT/s86MtYdDjA0RGIYX7pyHjGJymiLLAmRUG2sU4oHodkGJpMUcYWtmqAd/mYwjigI4CEroFzyNDn+qkXNYGbpM2VL5cFjFEZMmDjrQ9lO8NxH5XIHRdVWShVpEMTTAUulHJN/TNOADZ558sZpHGrF0t2UZZKUt1TfYboBODKM673gbhGYJe5gSRlyRB11RdlVSxZFVZ32J6bXFnJPW7IHFFWAWOqfE8sHTRrlJJRGGPCadJO3WyqTFmVaoooiAKgsAZmuSZul2XUROEJoAGB02lrssAgFZVhHXGd/NYPJFlgh8UkUOjFtOqMFZVsAxZEgAHOFVVsCTX1OxaWRZ5nsegcqvCmmrBdXLQyxPDvhxCOomYQU/OYiFyOVgrGSpTKWOOJSxHU2U8lEpZ1FXB1jmvxsa+kKUshDliNJQ7mej5+Sgi8YRcr2DbeUykqRRrItnS8Gs+MKWoKTk6YyoF6NDtNhOFRWwEEUU0dqWbaVnEIbeURCCO2ThkfZd1GpRj0KjBIpPzmmQYlLo9YWsg7mzJWcZhFwgM4KN8EvGug6NTSEKAIN1o4CXJ+X4eR9Kx1h1nA6FNH22GOJUhnaZ0FBURLBBvLw+mk53xePv55OFs+mh68s3J+MHx8e7kZPf0dG8yuf/9wb3vDrZezB+fzR+fTvdm073x8f3J8wezycNPA1NCY7uLHT8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Not all curve textures align perfectly in the original engine.\"\n        title=\"Not all curve textures align perfectly in the original engine.\"\n        src=\"/static/72e52936f7f0c01a5541c3b4ec94ff21/0a47e/traintrack_original.png\"\n        srcset=\"/static/72e52936f7f0c01a5541c3b4ec94ff21/8a4e8/traintrack_original.png 150w,\n/static/72e52936f7f0c01a5541c3b4ec94ff21/5a46d/traintrack_original.png 300w,\n/static/72e52936f7f0c01a5541c3b4ec94ff21/0a47e/traintrack_original.png 600w,\n/static/72e52936f7f0c01a5541c3b4ec94ff21/1cfc2/traintrack_original.png 900w,\n/static/72e52936f7f0c01a5541c3b4ec94ff21/7a1fb/traintrack_original.png 1030w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>So let's not waste time trying to replicate them. Instead, we can try to come up with our own quads. Consider the following image:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c387cbbece5b4bf5bd06311ff75a6860/aa08e/curve_texture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 126.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACjElEQVQ4y72T60/TUBjG+fP8QjQBnCzdgI61bOtYtwHKJTOGDxAjqFx0mzIVSBZITDBZghE1MXzwlmhiFOKNbAbqBhvdpe1Oe3p6bLsAug0yovFN07Sn59fznud5ThOuVwCivAgVFeETq6l2SALKZmovnZclWdVftVPBQFb4fNHANO3UKyOEoKKcvOaxsKqqsizjBuqvYWQWhFA1S1GURmFdFX2qDoiiKJklCML/avsfw8CEtcpluK0h1LDPMgDGk4YwNAwvA8hlxYZgPdLFssEoAsh83f64kbo+u7i0+tL475+ZqxfPsvxk7c2jxIvY4srE1F12cNTq9DJDYz9zQlVmq2Fkfo9enW4hGYJmLc5eu7vP4b1kIZlIPHEMDCHO5TDPo/19XCzFbsdaHN5OZoD0XrT1BKyU3+pkSXZkI5n5vfkDWFdoZwdzHOI4vLs7NxU92+G2uwLtTpboCXb7h6ngiKc/NDYzX4ZHR6a67crwXHje3jvkHrgSCI1TgeHeoVGHb1Bf/BxBP15/X3GkvmBY1W6F4yOTsfHI8ujN+1aKbe10tXW427t9F0iGDV3jS3Jl802HycClEhYEVb8DEJ6cPWPpOt/pabW72ro8FoeX6Al0ePpJpt9CepZX180QoANYkvDWFk6lUDKJt3ciN8LNBE3QfrsraHMFbDRro/3tlI/qC808ePjs9ZdPyVw9q0wlI9PRZoLSrSJon53pcwRDoYnIwsrzD5s/Srwki6AoABketl0o6CLjbBbt7eFMZm1h6fL0vck78Wg8kXj66vN3rlSQjK0ZOtX6nM3qPuF0Gu9mxK3ku7ffeL4sFYAGDGdwWcJpTjs6KidlW8sJ0JyjK4o0cy+aqtbO/AVi/EEGpFTxKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Calculating the quad corner points\"\n        title=\"Calculating the quad corner points\"\n        src=\"/static/c387cbbece5b4bf5bd06311ff75a6860/0a47e/curve_texture.png\"\n        srcset=\"/static/c387cbbece5b4bf5bd06311ff75a6860/8a4e8/curve_texture.png 150w,\n/static/c387cbbece5b4bf5bd06311ff75a6860/5a46d/curve_texture.png 300w,\n/static/c387cbbece5b4bf5bd06311ff75a6860/0a47e/curve_texture.png 600w,\n/static/c387cbbece5b4bf5bd06311ff75a6860/1cfc2/curve_texture.png 900w,\n/static/c387cbbece5b4bf5bd06311ff75a6860/aa08e/curve_texture.png 967w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Starting from <code>CenterLeft</code>, we can calculate <code>A</code> by going up <code>halfRoadWidth</code> units and <code>Center</code> by going up <code>3.5 * halfRoadWidth</code> units.</p>\n<p><code>B</code> needs to be further down than just <code>halfRoadWidth</code>. The part labeled <code>additionalRadius</code> can be calculated using a 15° triangle as follows:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c2f73b85d0c1f0de5e224b7d67e07531/aa08e/additional_radius.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 126.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAHHNAABxzQEma2s1AAACg0lEQVQ4y52U20/TUBzH9//54iW6GGZLWUu7dpfgCowHCbeBg6DxAuKjMfHJEIMvIsYHnRhjlIS4hIRM6bqu60pZN9r1tp5jNwUmG2g9OQ/n/JJPfpfv95wA7LUM261qTtMF8NwV6A5pmpHbLe/rTdtx/cDtTNaBqm7lWrf/yOwaZu3jF2AY0HX9w6YpZz83+SJ0HN8wsKzK5tdGUWydAfAJm2Z5t1gryRD47xk0DInfl/fK0LL8w4ZRKVREUXWqavsOfMGmB5dkXRek89s+pTOAigLKUoWTSjVH5URPLXA232USterB0g+xpLlSXgC23RLvn+Ajk1QFRW1CRdYOBTG3s/Ng+VE+/727hR4wNM3sm+yTF+tLj5/Oj0/Fk8nrIXTx7r12ZeAv3vaMNTeZuYjS1/AEhRARmqHjif4wnv2w2aqrw7O9YNvJTC0EiQQaHWGI+CBOYGQEIwan02m9oXcWf7rsVthpZiYXroRjN2gWG4izOJVIjbGjo7Ghoeerq53JAyciebsdbR7qmVsZJJ4ih8fZsekRmk6OpQiKCaEYRhA8zx8nD/wpM2jPy5yYu4NGhxEq2RdhcSLcFwqF0AGCiiAD4aWVlS7YrENdhg0FaBXo1NMzMxeCeBCLXsVi/ThJUzgZjZEMg5Mkk0jscdwv/jcMNAlU80AtAGUXNuSZ2/OXURqhbiI0i1KxCBnGBimv5/tLy9vfclbbOWcMDDhzs7OXUAahkyjDMiMTDxfT66/XeaHkul06e7Oq22LdLnu7ZpcNS3q1sfZs7e3LjXfvP23lOcHwvqSOuRzbrAW70FUs7sAqHNhF1SkINX6b40+Z0Tt3O7yXPcHJvwmOVs+H8RNyCkOJooDVIwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Calculating additionalRadius\"\n        title=\"Calculating additionalRadius\"\n        src=\"/static/c2f73b85d0c1f0de5e224b7d67e07531/0a47e/additional_radius.png\"\n        srcset=\"/static/c2f73b85d0c1f0de5e224b7d67e07531/8a4e8/additional_radius.png 150w,\n/static/c2f73b85d0c1f0de5e224b7d67e07531/5a46d/additional_radius.png 300w,\n/static/c2f73b85d0c1f0de5e224b7d67e07531/0a47e/additional_radius.png 600w,\n/static/c2f73b85d0c1f0de5e224b7d67e07531/1cfc2/additional_radius.png 900w,\n/static/c2f73b85d0c1f0de5e224b7d67e07531/aa08e/additional_radius.png 967w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><code>cos(15°) = (radius + hrw) / (radius + hrw + additionalRadius)</code></p>\n<p><code>additionalRadius = (radius + hrw) * (1 - cos(15°)) / (cos(15°)</code></p>\n<p>We can use these formulas for both the world coordinates and the texture coordinates.</p>\n<h2>Summing up</h2>\n<p>Now all that's left to do is generating the right number of quads based on the curve angle. Some textures don't fill the entire quad, which is why we need the quads to overlap slightly.</p>\n<p>Tight curves work just the same, the only difference is the smaller radius (<code>1.28</code> instead of <code>3.5</code>).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cab1c758235dab851071a5349b9e8d7a/eb3fa/curve.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7CAAAOwgEVKEqAAAADKUlEQVQozyWS23LbNhCG+Qqd6UVa25FsSRR1MGWJZxAAAQIgCYKkJJqO7cSR01ykM32kjjudSWvJqdNETfKApduZ7wK72P1n8WO1vx9///Bwt9v++mF397C92z3c3W9/+/jxj8+f7/f77Zcvu0+f7h8f3//1+P6/5Pbr1923b7t/9n/u9/capz2C+xjpPB4L1iekC8KubR8sFs8s+8D1jhzvRx8cQdgNYScIjjA+BuB5EBz63oGWZg5lBMdRiPwA9AHsI6QjrIdwAMIBIUbMRkKMk2RM6YhQnXEDor4fHLteT8OxH0DoQ+B4ju305lbHdo4dtxuAkwjrnBucjf6v9rxOiAaIzHFkRmTcnrUQgbltW65zZtmuP3K95z7oATgIwx4hOol0SnWIegHoBOHY9qy543gg8ALPA57mAn9mLdzAP7Msy1l4vgHxgDI9SQwpp1xMWhg3I+qGGAEMIUEBBJjgTBIty3kbtEASeTAMEEQkJHFAuZdlYZphymDrCI4JT2IhKCYh5bSsqJIzrSwtKSmlGEVtD2KCJAnlgralXMRMxDyhjGPGUUQAjoBISF6EeT4V3NCqwmhqe7lqx6CcExpHLYSiJwgkMaYxjshTmCRRUdIss1oLW9sD3NVursFVYxVSXxbzsvJX6yhXMJNRUTClWFHERUGXFVlWQSpO2z9r22J+RuIJigZas5rfXMK6mGWtQ5leV+b58qySU5WMq2KWp+MyN5fFLBEnuTRUPklTg8R6RA1MDK1U0/OVUyozTQYyHdeVdd34Mp0QMsizUb20WolCTTnrZ6muckOmesJ77Z61aEIMpTRWS7Op50U+StNBriY41mOmC6ErZV419ssL98W5o/J21YZR1BWsp5RRr2faZWOXaqie3nxayFMlR2nWyg3r+jTNTjA6jEW/rMx1aebtlRgk/CRP+6tydLEytVc/XV2+uWxeXtQ1WS9n6+JMstEqX6wrf115KpvLxCiyYZb0Cjmum+D6TX5zmzdXfLkG2veHnWfHw+9+6JghuX23US8g2sz5zxJsWHjL8Nsk+4WJm8Xqgr1+t1lv3sb1a1o2YVo6GP0LZloBDPGlEWMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Rendered broad curve\"\n        title=\"Rendered broad curve\"\n        src=\"/static/cab1c758235dab851071a5349b9e8d7a/0a47e/curve.png\"\n        srcset=\"/static/cab1c758235dab851071a5349b9e8d7a/8a4e8/curve.png 150w,\n/static/cab1c758235dab851071a5349b9e8d7a/5a46d/curve.png 300w,\n/static/cab1c758235dab851071a5349b9e8d7a/0a47e/curve.png 600w,\n/static/cab1c758235dab851071a5349b9e8d7a/1cfc2/curve.png 900w,\n/static/cab1c758235dab851071a5349b9e8d7a/eb3fa/curve.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef3af8b8442c90253be0e5fce88b48ce/eb3fa/traintrack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7CAAAOwgEVKEqAAAADK0lEQVQozxVSXY+bRhTlL/ShUpp2d+31YpgZhi8bMAzfAwwwgME4u22TzSqKqj7l/1RpH9duqyZq7G77+8pK5+HoXl2de8+5wvHw6+Hw8fHxl+Ph4+HxmR+Pv3369Pj58+F0Oj49/XE+H0+nw3///vn0z9+n05fzecJfpy/H8+l3YW1965FL4s8s51I3XhrGS9u50PDFcnnt2LMin2d0HkdXLF/wCqQUJQmOIuz62PGwEEZikkopBQkFNJNZDhibAONAD4jdMGMc9L7V+k7dD8bYq9tO4TUqGagqRciym4wuKV0mqRglzygZ5BWscjkJTN+1K2q0DaprmVdyU8OuxdN8XUmMSULbwbaBvAZlKdEM5AzRXC5L0DYKZzDwTOJaZap2LWonTQ75VG+UqgYVB0JXq7tO7zu8ndoc9Vvc9zpv1JzJRQVpCkOy2tgGS3BZLCsm8xr2W318PkET4sDJYpuGqClB36H9Tn81Gt0Wl9W0i5yXYhoAb2NsHLNMjJyKBVvwWhp6ZT+oQkAcx1l77jrxTRrqNMFpLLMS8lZpGtT3uCwRDXTLNlYrLXZhkcGqhnWlsgoKPNMSF4eeoZkG1nXN0AxDWZlyQKQ8Q7xSc6p5jqKZmghkUwcRgUU5uW2mGRK6Rkli4G6k9QroOkIYLSFSNLxeaxsLuza2VkjVFBlCCcqmKm1Wiyi+IeSakIVQMEDChe1dO5s5cSXLlFcmsm0NYCRjrKgYYAxVLEMwydq6aFnXK+s7y7naeHMhDBeuPyeBmGbAD2dxItEYRS6yDGhbeBJfGdB3tMBB3lom3tIPRcudu2QRREshikU/emaUwrLS80LuO3PorMSHWag0uVYEkIVKX+F2CpmjrtN4q+alEiSi4JG5R658fx7F028YLJsSwsNOG3p1P5rjTmtbOO70u73Gm+VuQPsRDVvUtijLb4Th+3F4/Wr84bas3Tids2Lyc5Hnyjh4t2O0a+2+1t/sNn0HtgO6vfXu3/H9j3S8o92OCF9fzF7MxK++uUQbf//2LhuIf28mPxXufeq+TYJ3Of9Qte+ju9fNw88Pw8P7ZPcmafde0VpB8D8GuPiabvEtaAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Rendered tight curve\"\n        title=\"Rendered tight curve\"\n        src=\"/static/ef3af8b8442c90253be0e5fce88b48ce/0a47e/traintrack.png\"\n        srcset=\"/static/ef3af8b8442c90253be0e5fce88b48ce/8a4e8/traintrack.png 150w,\n/static/ef3af8b8442c90253be0e5fce88b48ce/5a46d/traintrack.png 300w,\n/static/ef3af8b8442c90253be0e5fce88b48ce/0a47e/traintrack.png 600w,\n/static/ef3af8b8442c90253be0e5fce88b48ce/1cfc2/traintrack.png 900w,\n/static/ef3af8b8442c90253be0e5fce88b48ce/eb3fa/traintrack.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We can now render all road types except the end caps!</p>\n<p>There's one elephant in the room, though, that we ignored so far: We don't consider the terrain height yet.</p>\n<p>But that's another story for another post...</p>","frontmatter":{"slug":"roads-how-boring-part-9-rendering-curves","title":"Roads? How boring! Part 9: Rendering curves","summary":"Part 9 of the series about rendering the roads in SAGE maps: Rendering curves","author":"Daniel Sklenitzka","date":"2020-05-03"}}},"pageContext":{"slug":"roads-how-boring-part-9-rendering-curves"}}}