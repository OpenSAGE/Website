{"data":{"markdownRemark":{"html":"<p><em><a href=\"http://timjones.io/blog/archive/2017/12/10/opensage-dev-diary-2-2017-12-10\">This post</a> was originally published on Tim's blog.</em></p>\n<p>Following on from <a href=\"/blog/dev-diary-1/\">last week's post</a>, here is what's been happening this week in OpenSAGE.</p>\n<h2>Progress this week</h2>\n<p>This week, I have:</p>\n<ul>\n<li>\n<p>Implemented a new build system for shaders. Previously, shaders were compiled (at build time) using the <a href=\"https://www.nuget.org/packages/Microsoft.HLSL.CSharpVB/\">Microsoft.HLSL.CSharpVB MSBuild targets</a> from NuGet. This had a couple of limitations: first, the method this NuGet package used to find <code class=\"language-text\">fxc.exe</code> <a href=\"https://github.com/OpenSAGE/OpenSAGE/issues/8\">didn't work</a> with recent Windows Kits. Second, vertex and pixel shaders had to be in separate files, which didn't fit well with the runtime Effect system I've been building. The new shader build system uses a custom MSBuild <code class=\"language-text\">.targets</code> file and a custom C# MSBuild <code class=\"language-text\">Task</code> to compile all the <code class=\"language-text\">.fx</code> files found in the OpenSage.Game project, and embed the resulting bytecode as embedded resources. <a href=\"https://github.com/OpenSAGE/OpenSAGE/tree/master/build\">Source code here</a>.</p>\n</li>\n<li>\n<p>Started implementing a GUI renderer. More details on GUI rendering below.</p>\n</li>\n<li>\n<p>Started porting the existing Data Viewer application from WPF to <a href=\"https://github.com/picoe/Eto\">Eto.Forms</a>, a cross-platform UI framework that, like Xamarin Forms, uses native widgets on each platform. I plan to bring OpenSAGE to the Mac soon, and this is an important preparatory step.</p>\n</li>\n</ul>\n<h2>GUI rendering</h2>\n<p>In C&#x26;C Generals, almost all the UI (i.e. everything except for the 3D bits) is defined in <code class=\"language-text\">.wnd</code> files. This includes the main menu, the options screen, the multiplayer game setup screen, even the command bar at the bottom of the screen during gameplay.</p>\n<p><code class=\"language-text\">.wnd</code> are plain-text files that look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FILE_VERSION = 2;\nSTARTLAYOUTBLOCK\n  LAYOUTINIT = &quot;[None]&quot;;\n  LAYOUTUPDATE = &quot;[None]&quot;;\n  LAYOUTSHUTDOWN = &quot;[None]&quot;;\nENDLAYOUTBLOCK\nWINDOW\n  WINDOWTYPE = USER;\n  SCREENRECT = UPPERLEFT: 0 0,\n               BOTTOMRIGHT: 800 600,\n               CREATIONRESOLUTION: 800 600;\n  NAME = &quot;TheName&quot;;\n  STATUS = ENABLED+IMAGE;\n  STYLE = USER;\n  SYSTEMCALLBACK = &quot;[None]&quot;;\n  INPUTCALLBACK = &quot;[None]&quot;;\n  TOOLTIPCALLBACK = &quot;[None]&quot;;\n  DRAWCALLBACK = &quot;[None]&quot;;\n  FONT = NAME: &quot;Times New Roman&quot;, SIZE: 14, BOLD: 0;\n  HEADERTEMPLATE = &quot;[None]&quot;;\n  TOOLTIPDELAY = -1;\n  TEXTCOLOR = ENABLED:  255 255 255 255, ENABLEDBORDER:  255 255 255 255,\n              DISABLED: 255 255 255 255, DISABLEDBORDER: 255 255 255 255,\n              HILITE:   255 255 255 255, HILITEBORDER:   255 255 255 255;\n  ENABLEDDRAWDATA = IMAGE: SomeImageName, COLOR: 0 0 128 255, BORDERCOLOR: 254 254 254 255,\n                    ...\n  DISABLEDDRAWDATA = IMAGE: NoImage, COLOR: 64 64 64 255, BORDERCOLOR: 254 254 254 255,\n                     ...\n  HILITEDRAWDATA = IMAGE: NoImage, COLOR: 128 128 255 255, BORDERCOLOR: 254 254 254 255,\n                   ...\n  CHILD\n     ... Child window\n  WINDOW\n  ENDALLCHILDREN\nEND</code></pre></div>\n<p>A <code class=\"language-text\">WINDOW</code> definition (which is really an element of a window) contains information about size, colour, background image.\nThere are different window types for textboxes, listboxes, etc. Windows can have child windows, so something like the main menu\nhas a large hierarchy of \"windows\".</p>\n<p>I couldn't find any information about <code class=\"language-text\">.wnd</code> files by Googling, so I had to figure it out the hard way. For example, you can see above that there are references to images (<code class=\"language-text\">ENABLEDDRAWDATA = IMAGE: SomeImageName</code>). These don't correspond directly to images on disk. Instead, there is a folder of <code class=\"language-text\">.ini</code> files called MappedImages, and in there you'll find entries like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">MappedImage SomeImageName\n  Texture = TheActualTexture.tga\n  TextureWidth = 1024\n  TextureHeight = 256\n  Coords = Left:0 Top:64 Right:800 Bottom:255\n  Status = NONE\nEnd</code></pre></div>\n<p>These <code class=\"language-text\">MappedImage</code> entries contain the actual texture, as well as coordinates within that texture. Most GUI textures contain images for lots of GUI elements, so these coordinates provide the specific rectangle to use for a given GUI element.</p>\n<p>I've implemented a <code class=\"language-text\">.wnd</code> parser, and started on implementing a GUI renderer. Here's where I've got to this week: the basic bits are in place, but I'm not yet rendering text, and there's no mouse or keyboard input yet.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee8bf3553329e228ec8027e8f19f3c6b/1ee56/opensage-2017-12-10-gui.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 600px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAADHUlEQVQoz2WT20/bBRTHf5FoUDpwbLBwsdDWFtaWS+mNlt4vtKWF3oXeVqCsFINMCkNgNZuObc4txodpfDPGP8AHTXSb0UQfLPFVk704nfsHcOFBiePjb8YH0ZOc83AePud8zzdHuH3vDt8+/IavHnxN6XIe01QnI6EOHDEp3owCb1KGP9KDI3QKZ7wDX6Kb5KyW1KKJwoqF/MoYibIJV0bLeNmBcPDogMf7f/IkLq6fxy5rRN/TRNEuY/cVDy+PKdCrnkWnfAbn0HHSdjVnx1/ks6sGPtmx8/lbZu5cN/DukoJE0I1Qv79L/Zc69Yffc7G2QtTWhsHcTjoyxPsLAdbSFmqLATxGKRZzL7mEl1HNMSZsx1CJgweVz6FXNxE0NxCNOBH2ft/jtz/22Dt4RG19maxDynLaSiqoJxPS8+H6DL/ufsqN0hSVpIv5rIfTUoE+aQOSRoGWJoFmMYfE3lzSj8C/4nJti+1ihPtf3OJW2UPRo2ErZ2U1aydh7uFStUQ6ZMQ9KMHQ9zQdrQLS9qfobBMIDkt4fSGNcHh4KKIOeSzWG29eYGfBw4Mv3xZvM89qUMX5lJaiT0HOIWPntUVirmEyTjlWtYQWiSBCG2htEZj191Irz/wD/BsKb2ytUfHLuFSwcqGUoDJpYt7Xz+z4MCGTnHOlGZaSNqKWLgyiUU/ktj0vpripf6CRYtx/FFjbqDKlO0nZ2UncLGPaM0h8rI8zPg1zAS0Jt5bCuJayaFTO1cuZwABnJwYp+ZXMGU9QjPqOArfXXyUqAj/Ky7mSVDLtVpP16MjaFMx6+9mKjXAlM8rVSojlCQ0bWR/VtJ35wAix/uMUIq7/A/OWdm7m1Gynh0iOyojITvCSpplaQE795jL7926zf/ca11M6YnYN4VEVJo2cabuCfNx7FLhZPUfKcJKF8DBeg4KgUU54uJuloJp3sjp++HiTn378jp/vfsB7c6LzNlGFq5+8uH3Y2Mpk0PkfUzar5HXNZK1duDWnCOu7KbiVVEKnWQ2rWPV3sZEYYG2yT/ykLlHBC8RMneSdMuyaFrweG38BWj0HUqlLDTkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"OpenSAGE GUI - C&C Generals Main Menu\"\n        title=\"\"\n        src=\"/static/ee8bf3553329e228ec8027e8f19f3c6b/7a630/opensage-2017-12-10-gui.png\"\n        srcset=\"/static/ee8bf3553329e228ec8027e8f19f3c6b/46d37/opensage-2017-12-10-gui.png 150w,\n/static/ee8bf3553329e228ec8027e8f19f3c6b/c218a/opensage-2017-12-10-gui.png 300w,\n/static/ee8bf3553329e228ec8027e8f19f3c6b/7a630/opensage-2017-12-10-gui.png 600w,\n/static/ee8bf3553329e228ec8027e8f19f3c6b/91b84/opensage-2017-12-10-gui.png 900w,\n/static/ee8bf3553329e228ec8027e8f19f3c6b/b8f57/opensage-2017-12-10-gui.png 1200w,\n/static/ee8bf3553329e228ec8027e8f19f3c6b/6f30d/opensage-2017-12-10-gui.png 1800w,\n/static/ee8bf3553329e228ec8027e8f19f3c6b/1ee56/opensage-2017-12-10-gui.png 2880w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </span>\n  </a></p>\n<p>For reference, here is what the same screen looks like in the original game:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f6063d48b347658c53cd0e41c9cad08/ee433/opensage-2017-12-10-gui-original.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 600px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABYlAAAWJQFJUiTwAAADVElEQVQozw3QWW/aBgAAYD80IsUYCDghBHM4YOMLDLbxbYwbE8xliDkChcJI2iZpQ5KhNtm0Q5qqSpMmrVuladNe9jO2l0mTJu13rW/f8wdUUFA/9DtE0CGhJgXNxcgzIdQqQKd8ZCKG53JkIYYWtdTdqXo3NW6nTx5W9u20+sKtjKooYOSgoRztiNEXJ6nzbsYWdlwd6ZvIdQdrKLvrAfHSpVcu8s8v/J8/1/77Tfz3V/Xvj9JfP/L3ExRolXa/mhaXx/kjOTFv0Y6CLo65mxPlfqyMa5Rbxft24bR++PUqtWwfvu6jF2760ku/O4vfuHHgRNlfOkmdgflcVMh/AnreZDeetmwW1x5/3ywuDHJe56oFhEqBei6sZiEM8SkE2CzDQJOHxzVEoiMDg+ip5IBHByZ93S2fNYjzvvy6bww1ZlFnLRYWMLBKhHQcxJKPLAG6cbNAOe1XmHBdThkc4lnE4ohtSeRTE5/q6LLFr1z1szp93WZaQoxJP5bwoIJBmfiWSD+eGfuAmAMbcryjUiqTOZLRkUmcNbiZXbxqUuMa+83VaO1V5i28xkWIlN8kQlUcQuNbPOF79gQBDCrQ4NMlOlpidmw1+e1Kf/vUXHTVVwPlVU+8HuqujllqXC1E0AOfjkMGFsCQbSb7aKjFgA637yoJmglIlaijE5uJ9MdGc7jkyKJbCuGodJGESyxUwsP5tM8uwJ1STGf2tGJAp8BPYfELr6ypezqfqLLZ24n5/VXjrMWbXL6t0GUyhpPbJAnSJKRJkbaZuPXkNwN1aCXtUhAo5rbGTXzilMZ2edIQv3vZe3/lvbvomTy2HhuGmCCobZoGNTmsCbuqEO5quYnFPXfISycLMLktt55YtMSPd97vD5Mf1t6Hu9H7y/6buf1w7tSUWLEIsoVgVYINKSrxQddEl23x7UiY6GnAKu24xxHnCDm2kiOHGNrUw9L6clH76XPvi+cNmgwVCpDMw0IBrrCwYUScasoy8ZlD92UU8GRsM8QXXcRSwgYfFjlQKIFKJVDX4UHjkCUhjgKFQrDM+HUxrCtQXdtz9fxmVp7ZGNCVclMd9yS0V8l4YqbHH/SFvZ4Ad7iddjlcZyCTAquMX8S32YyPzfpkAjLpA4dPDczc/2XgzoV64piFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"C&C Generals Main Menu\"\n        title=\"\"\n        src=\"/static/2f6063d48b347658c53cd0e41c9cad08/7a630/opensage-2017-12-10-gui-original.png\"\n        srcset=\"/static/2f6063d48b347658c53cd0e41c9cad08/46d37/opensage-2017-12-10-gui-original.png 150w,\n/static/2f6063d48b347658c53cd0e41c9cad08/c218a/opensage-2017-12-10-gui-original.png 300w,\n/static/2f6063d48b347658c53cd0e41c9cad08/7a630/opensage-2017-12-10-gui-original.png 600w,\n/static/2f6063d48b347658c53cd0e41c9cad08/ee433/opensage-2017-12-10-gui-original.png 800w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </span>\n  </a></p>\n<p>Still plenty of work to do, but it's a start.</p>\n<h2>Next week</h2>\n<p>Next, I'm planning to finish porting the Data Viewer application to Eto.Forms, and then keep going with GUI rendering.</p>\n<p>See you next time!</p>","frontmatter":{"title":"OpenSAGE Dev Diary #2","author":"Tim Jones","date":"2017-12-10"}}},"pageContext":{"slug":"dev-diary-2"}}